# Enable email reports
This guide describes how to enable the email reports feature of Superset.

In order to enable the feature, the following conditions must be met on the charm deployment:
1. `ALERTS_REPORTS` feature flag is enabled.
2. `smtp-secret-id` configuration is set.

## Enabling the feature flag
Suppose Superset was deployed with the following:
```sh
juju deploy superset-k8s --config charm-function=worker --config feature-flags="$MY_FLAGS superset-worker"
```

Then, to enable `ALERTS_REPORTS` simply add it to the list of the feature flags:
```sh
juju config superset-worker feature-flags="$MY_FLAGS,ALERTS_REPORTS"
```

## Setting the SMTP secret ID configuration
Suppose Superset was deployed with the following:
```sh
juju deploy superset-k8s --config charm-function=worker --config feature-flags="ALERTS_REPORTS superset-worker"
```

First, create a file as such:
```yaml
host: <string>
port: <int>
username: <string>
password: <string>
email: <string>  # Sender of the emails
email-subject-prefix: <optional[string]>  # Prefix to use for the subject, '[Superset] ' by default
superset-internal-url: <string>  # URL to access the Superset UI application from the workers
superset-external-url: <string>  # URL that will be used to generate the links in the email reports
ssl: <bool>
start-tls: <bool>
ssl-server-auth: <bool>  # True, if you are using a valid certificate for the SMTP server
```

[note]
The keys generally correspond to the values under the `Email configuration` section from the
[official documentation](https://superset.apache.org/docs/configuration/alerts-reports/#detailed-config).

The values for `superset-internal-url` and `superset-external-url` deserve additional explanation.
- `superset-external-url` will be used to generate the links, so it should match a valid URL that allows users
to access your Superset deployment from their browsers.
- `superset-internal-url` will be used to generate the reports. Reports are generated by the workers imitating
actual users to browse the UI. Thus, the value should allow a worker pod to reach the UI pod. This can be
a Kubernetes provided domain. Assuming the UI is deployed as `superset-ui` and the worker is deployed in the same model,
a good value for this key is `http://superset-ui:8088`. You can check the 
[Kubernetes documentation](https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/) for more.
[/note]

Second, create a secret from your file:
```sh
juju add-secret smtp-config --file=/path/to/file
```

Its output will be of the format `secret:<secret-id>`, copy the `<secret-id>` then grant access and set it in the configuration:
```sh
juju grant-secret <secret-id> superset-worker
juju config superset-worker smtp-secret-id=<secret-id>
```
